# 브라우저는 어떻게 동작하는가?
이 기록은 [브라우저는 어떻게 동작하는가?](https://d2.naver.com/helloworld/59361)를 보고 학습한 내용을 정리한 것 입니다.

## 브라우저의 주요 기능
브라우저의 주요 기능은 사용자가 선택한 자원을 서버에 요청하고 브라우저에 표시하는 것이다. 자원은 보통 HTML 문서지만 PDF나 이미지 또는 다른 형태일 수 있다. 자원의 주소는 URI에 의해 정해진다.

HTML파일을 해석해서 표시하는데 이 명세는 웹 표준화 기구인 W3C(World Wide Web Consortium)에서 정한다.

## 브라우저의 기본 구조
1. 사용자 인터페이스 - 자료 표시줄, 이전/다음 버튼, 북마크 메뉴 등 페이지를 보여주는 창을 제외한 모든 부분
2. 브라우저 엔진 - 1과 3 사이의 동작을 제어
3. 렌더링 엔진 - 요청한 콘텐츠를 표시, 예를 들어 HTML과 CSS를 파싱하여 화면에 표시
4. 통신 - HTTP 요청과 같은 네트워크 호출에 사용
5. UI 백엔드 - 콤보 박스와 같은 기본적인 장치를 그림, 플랫폼에서 명시하지 않은 일반적인 인터페이스로서, OS 사용자 인터페이스 체계를 사용
6. 자바스크립트 해석기 - 자바스크립트 코드 해석, 실행
7. 자료 저장소 - 자료를 저장, 쿠키 및 모든 자원 저장, HTML5에서는 웹 데이터베이스가 정의되어 있음.

![브라우저의 기본 구조](/img/hdbw1.png)

### 렌더링 엔진
- 역할 : 요청받은 내용을 브라우저 화면에 표시
#### 동작과정
렌더링 엔진은 통신으로부터 요청한 문서의 내용을 얻는 것으로 시작, 문서의 내용은 보통 8KB 단위로 전송된다.

![브라우저의 기본 구조](/img/hdbw2.png)

1. HTML 문서를 파싱
2. 콘텐츠 트리 내부에서 태그를 DOM 노드로 변환
3. CSS 파일과 함께 스타일 요소 파싱
4. 스타일 정보와 HTML 표시 규칙은 렌더 트리 라고 부르는 또 다른 트리를 생성

렌더 트리는 색상 또는 면적과 같은 시각적 속성이 있는 사각형을 포함하고 있는데 정해진 순서대로 화면에 표시된다.

렌더 트리 생성이 끝나면 배치가 시작되는데 이것은 각 노드가 화면의 정확한 위치에 표시되는 것을 의미한다. 다음은 UI 백엔드에서 렌더 트리의 각 노드를 가로지르며 형상을 만들어 내는 그리기 과정이다.

일련의 과정들이 점진적으로 진행된다는 것을 아는 것이 중요하다. **렌더링 엔진은 좀 더 나은 사용자 경험을 위해 가능하면 빠르게 내용을 표시**하는데 모든 HTML을 파싱할 때까지 기다리지 않고 배치와 그리기 과정을 시작한다. **네트워크로부터 나머지 내용이 전송되기를 기다리는 동시에 받은 내용의 일부를 먼저 화면에 표시**하는 것이다.

## 파싱과 DOM 트리 구축

### 파싱 일반
문서 파싱은 브라우저가 코드를 이해하고 사용할 수 있는 구조로 변환하는 것을 의미한다. 파싱 결과는 보통 문서 구조를 나타내는 노드 트리인데 파싱 트리(parse tree) 또는 문법 트리(syntax tree)라고 부른다.

예를 들면 2+3-1과 같은 표현식은 다음과 같은 트리가 된다.
![브라우저의 기본 구조](/img/hdbw3.png)

### 문법
파싱은 문서에 작성된 언어 또는 형식의 규칙에 따르는데 파싱할 수 있는 모든 형식은 정해진 용어와 구문 규칙에 따라야 한다. 

### 파서-어휘 분석기 조합

파싱은 **어휘 분석**과 **구문 분석**이라는 두 가지로 구분할 수 있다.


어휘 분석은 자료를 토큰으로 분해하는 과정이다. 토큰은 유효하게 구성된 단위의 집합체로 용어집이라고도 할 수 있는데 인간의 언어로 말하자면 사전에 등장하는 모든 단어에 해당된다.

구문 분석은 언어의 구문 규칙을 적용하는 과정이다.

파서는 보통 두 가지 일
1. 자료를 유효한 토큰으로 분해하는 어휘 분석기(토큰 변환기 라고도 부름)
2. 언어 구문 규칙에 따라 문서 구조를 분석함으로써 파싱 트리를 생성하는 파서